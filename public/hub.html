<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Allstar Agent Hub</title>
<style>
:root{ --bg:#0f1115; --panel:#111827; --text:#e5e7eb; --muted:#9ca3af;
       --brand:#c0392b; --brand-700:#a93226; --card:#1f2937; --border:#374151; }
*{box-sizing:border-box} html,body{height:100%}
body{margin:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial}
a{color:inherit;text-decoration:none}
header{position:sticky;top:0;z-index:5;background:var(--panel);border-bottom:2px solid var(--brand)}
.container{max-width:1100px;margin:0 auto;padding:18px 20px}
.row{display:flex;gap:14px;align-items:center;flex-wrap:wrap}
h1{margin:0;font-size:24px}
.brand{color:var(--brand);font-weight:800}
.pill{border:1px solid var(--border);border-radius:999px;padding:6px 10px;font-size:12px;background:#111827;margin-left:auto}
.btn{border:1px solid var(--border);background:var(--card);color:var(--text);padding:8px 12px;border-radius:10px;cursor:pointer}
.btn.brand{background:var(--brand);border-color:var(--brand);color:#fff}
.btn.brand:hover{background:var(--brand-700)}
.notice{margin:16px 0;padding:12px;border:1px dashed var(--brand);border-radius:12px;background:rgba(192,57,43,.08);color:#ffdada;display:none}
.grid{display:grid;gap:16px;grid-template-columns:repeat(1,minmax(0,1fr))}
@media(min-width:760px){ .grid{grid-template-columns:repeat(2,minmax(0,1fr))} }
.cardLink{display:block;background:var(--card);border:1px solid var(--border);border-radius:14px;padding:18px;transition:transform .12s ease, border-color .12s ease}
.cardLink:hover{transform:translateY(-2px);border-color:var(--brand)}
.cardLink h3{margin:0 0 6px;font-size:18px}
.cardLink p{margin:0;color:var(--muted)}
.badge{display:inline-block;padding:2px 8px;border-radius:999px;font-size:11px;margin-left:8px;background:rgba(192,57,43,.18);color:#ffdada;border:1px solid rgba(192,57,43,.35);}
</style>
</head>
<body>
<header>
  <div class="container">
    <div class="row">
      <h1>Allstar <span class="brand">Agent Hub</span></h1>
      <div id="hdrUser" class="pill">Checking sign-in‚Ä¶</div>
      <button id="btnLogout" class="btn">Logout</button>
    </div>
  </div>
</header>

<main class="container">
  <div id="news" class="notice"></div>
  <div class="grid">
    <a class="cardLink" href="/flowmaster">
      <h3>üìû FlowMaster <span class="badge">Scripts + Rebuttals</span></h3>
      <p>Call flows, rebuttals, SMS helper, and tools in one place.</p>
    </a>
    <a class="cardLink" href="/schedule">
      <h3>üìÖ Adherence &amp; Scheduling <span class="badge">Live % + Editor</span></h3>
      <p>Agents set live status; Admins edit schedules, view status &amp; history, export CSV.</p>
    </a>
    <a class="cardLink" href="/hub">
      <h3>üì∞ Team Billboard</h3>
      <p>Company memos auto-pulled from Notion.</p>
    </a>
    <a class="cardLink" href="https://www.notion.so/" target="_blank" rel="noopener">
      <h3>‚úçÔ∏è Manage News in Notion</h3>
      <p>Admins update the Team Billboard in Notion; the Hub auto-refreshes.</p>
    </a>
  </div>
</main>

<script>
const API = "/api";
async function whoami(){
  try{ const r=await fetch(API+"/whoami",{credentials:"include"}); if(!r.ok) return null; return await r.json(); }catch{return null;}
}
async function logout(){ try{ await fetch(API+"/logout",{method:"POST",credentials:"include"}); }catch{} location.href="/"; }

document.getElementById('btnLogout').addEventListener('click', logout);

(async ()=>{
  const me = await whoami();
  const hdr = document.getElementById('hdrUser');
  if(!me || !me.username){ location.href="/"; return; }
  hdr.textContent = `${me.username} ¬∑ ${me.role}`;

  try{
    const r = await fetch(API + "/billboard", { credentials:"include" });
    const j = r.ok ? await r.json() : { items: [] };
    if (j.items && j.items.length){
      const it = j.items[0];
      const news = document.getElementById('news');
      news.style.display = 'block';
      news.innerHTML = `<strong>Latest:</strong> ${it.title}${it.text ? " ‚Äî " + it.text : ""}`;
    }
  }catch{}
})();
</script>
</body>
</html>
